<!-- 
    Copyright 2014-2018 Travel Modelling Group, Department of Civil Engineering, University of Toronto

    This file is part of XTMF.

    XTMF is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    XTMF is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with XTMF.  If not, see <http://www.gnu.org/licenses/>.
-->
<UserControl x:Class="XTMF.Gui.UserControls.ModelSystemDisplay"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:xtmf="clr-namespace:XTMF;assembly=XTMF"
             xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
             xmlns:models="clr-namespace:XTMF.Gui.Models"
             xmlns:my="clr-namespace:XTMF.Gui" Margin="0" 
             xmlns:this="clr-namespace:XTMF.Gui.UserControls"
             xmlns:this2="clr-namespace:XTMF.Gui.UserControls"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:dragablz="http://dragablz.net/winfx/xaml/dragablz"
             KeyboardNavigation.IsTabStop="True"
             FocusManager.FocusedElement="{Binding Source={x:Reference Name=FilterBox}}"
             mc:Ignorable="d" Name="MDisplay" PreviewKeyDown="ModelSystemDisplay_OnPreviewKeyDown"
             d:DesignHeight="500" d:DesignWidth="2000" Background="{DynamicResource MaterialDesignPaper}" Unloaded="MDisplay_Unloaded" MouseMove="MDisplay_MouseMove">
    <UserControl.Resources>
        <VisualBrush x:Key="TextureBrush" TileMode="Tile" Viewport="0,0,20,20" Viewbox="0,0,14,14" ViewportUnits="Absolute" ViewboxUnits="Absolute">
            <VisualBrush.Visual>
                <Rectangle SnapsToDevicePixels="True" Opacity="0.2" Stroke="{DynamicResource PrimaryHueLightForegroundBrush}" StrokeThickness="0.8" Width="20" Height="20"/>
            </VisualBrush.Visual>
        </VisualBrush>
        <DataTemplate x:Key="ModuleValidationErrorTemplate" x:Name="ModuleValidationErrorTemplate" DataType="{x:Type models:ValidationErrorDisplayModel}">
            <this:ValidationErrorListControl Tag="{Binding DisplayModule}" Height="80" MouseDoubleClick="ValidationListModuleNameMouseDown" />
        </DataTemplate>
        <DataTemplate x:Key="ModuleDisabledTemplate" DataType="{x:Type models:ModelSystemStructureDisplayModel}">
            <Grid Background="Transparent" HorizontalAlignment="Stretch">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1*"/>
                    <ColumnDefinition Width="1*"/>
                    <ColumnDefinition Width="30"/>
                </Grid.ColumnDefinitions>
                <Label Foreground="{DynamicResource MaterialDesignBody}" Grid.Column="0" Content="{Binding Name}"/>
                <Label Name="EnableDisableLabel" Grid.Column="1" Foreground="{DynamicResource PrimaryHueMidBrush}"  Tag="{Binding Path=.}" Content="Enable Module" MouseDown="ModelSystemInformation_EnableModuleMouseDown"/>
            </Grid>
        </DataTemplate>
        <DataTemplate x:Key="ModuleEnabledTemplate" DataType="{x:Type models:ModelSystemStructureDisplayModel}">
            <Grid Background="Transparent" HorizontalAlignment="Stretch">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1*"/>
                    <ColumnDefinition Width="1*"/>
                    <ColumnDefinition Width="30"/>
                </Grid.ColumnDefinitions>
                <Label Foreground="{DynamicResource MaterialDesignBody}" Grid.Column="0" Content="{Binding Name}"></Label>
                <Label  Name="EnableDisableLabel" Grid.Column="1" Foreground="{DynamicResource PrimaryHueMidBrush}" Tag="{Binding Path=.}" Content="Disable Module" MouseDown="ModelSystemInformation_EnableModuleMouseDown"/>
                <Border ToolTip="Remove module from list" Cursor="Hand" Tag="{Binding Path=.}" Grid.Column="2" Background="{DynamicResource MaterialDesignCardBackground}" MouseDown="Path_MouseDown">
                    <Path IsHitTestVisible="False" Tag="{Binding Path=.}" Data="{DynamicResource CancelIconPath}" Fill="{DynamicResource MaterialDesignBody}" Opacity="0.5"/>
                </Border>
            </Grid>
        </DataTemplate>
        <models:ModelSystemInfoTemplateSelector  x:Key="ModelSystemInfoTemplateSelector" ModuleDisabled="{StaticResource ModuleDisabledTemplate}"
                                                ModuleEnabled="{StaticResource ModuleEnabledTemplate}"/>
        <DataTemplate  x:Key="StandardParameterTemplate" DataType="{x:Type models:ParameterDisplayModel}" >
            <StackPanel materialDesign:TransitionAssist.DisableTransitions="True"  PreviewKeyDown="B_OnPreviewKeyDown"  GotFocus="B_OnGotFocus" MaxWidth="{Binding RelativeSource={RelativeSource Mode=FindAncestor,
                    AncestorType=this:ModelSystemDisplay}, Path=ParameterWidth}"  Name="StandardParameterTemplatePanel"
                     HorizontalAlignment="Stretch" Margin="0 0 0 0"  >
                <StackPanel.ToolTip>
                    <StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding Name, Mode=OneTime}" FontWeight="Bold" Margin="0 0 3 0" />
                            <TextBlock Text="-" />
                            <TextBlock Text="{Binding OwnerModuleName, Mode=OneTime}" FontWeight="Light" Margin="3 0 0 0" />
                        </StackPanel>
                        <TextBlock Text="{Binding Description, Mode=OneTime}" />
                    </StackPanel>
                </StackPanel.ToolTip>
                <StackPanel materialDesign:TransitionAssist.DisableTransitions="True"   Focusable="False"  Orientation="Vertical" HorizontalAlignment="Stretch" CanHorizontallyScroll="False"
                                    x:Name="ParameterBorder">
                    <Grid materialDesign:TransitionAssist.DisableTransitions="True" AllowDrop="False"   Focusable="False" HorizontalAlignment="Stretch"  Name="ParameterDisplayContainerGrid" >
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="16"/>
                            <ColumnDefinition Width="AUTO"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="AUTO"/>
                            <ColumnDefinition Width="AUTO"/>
                        </Grid.ColumnDefinitions>
                        <CheckBox materialDesign:TransitionAssist.DisableTransitions="True"  Grid.Column="1" Width="16" Margin="4,4,0,0" Height="16" VerticalAlignment="Center" IsChecked="{Binding QuickParameter}" ToolTip="Quick Parameter" Checked="ToggleButton_OnChecked"  Unchecked="ToggleButton_OnUnchecked"
                                          IsTabStop="False"/>
                        <TextBox   PreviewDragOver="StandardParameterTemplateTextBox_OnPreviewDragOver" Name="StandardParameterTemplateTextBox"  AllowDrop="True" LostFocus="TextBox_OnLostFocus"
                                   TextChanged="TextBox_OnTextChanged" HorizontalContentAlignment="Left" Tag="{Binding .}" Grid.Column="2"
                                   Style="{StaticResource XtmfMaterialDesignFloatingHintTextBox}"  TextWrapping="Wrap" VerticalContentAlignment="Center" materialDesign:HintAssist.Hint="{Binding Name, Mode=OneTime}"
                                           GotKeyboardFocus="ParameterValueTextBox_OnGotKeyboardFocus" CaretBrush="{DynamicResource SecondaryHueDarkBrush}"
                                          Margin="5,5,5,5" HorizontalAlignment="Stretch" Text="{Binding Value, NotifyOnSourceUpdated=True}" FocusManager.IsFocusScope="True"
                                          PreviewKeyDown="HintedTextBox_PreviewKeyDown" Foreground="{DynamicResource MaterialDesignBody}" Drop="StandardParameterTemplateTextBox_OnDrop"
                                          SelectionOpacity="0.6" MinHeight="15" Padding="5" LostKeyboardFocus="TextBox_OnLostKeyboardFocus"
                                   ContextMenu="{Binding RelativeSource={RelativeSource AncestorType=ListView}, Path=ContextMenu}"/>

                        <StackPanel materialDesign:TransitionAssist.DisableTransitions="True"   Grid.Column="0" Orientation="Vertical" VerticalAlignment="Center">
                            <materialDesign:PackIcon Kind="LinkVariant" ToolTip="{Binding LinkedParameterName}" Visibility="{Binding LinkedParameterVisibility}"/>
                            <materialDesign:PackIcon Kind="Settings"  ToolTip="System Parameter" Visibility="{Binding SystemParameterVisibility, Mode=OneTime}"/>
                            <materialDesign:PackIcon Kind="DoNotDisturbAlt" ToolTip="Associated module is disabled" Visibility="{Binding ModuledDisabledIconVisiblity}"/>
                        </StackPanel>
                    </Grid>

                </StackPanel>
                <Border Background="{DynamicResource MaterialDesignDivider}" Height="1" HorizontalAlignment="Stretch" SnapsToDevicePixels="True" />
            </StackPanel>
        </DataTemplate>
        <DataTemplate x:Key="EnumerationParameterTemplate">
            <StackPanel PreviewKeyDown="B_OnPreviewKeyDown"  MaxWidth="{Binding RelativeSource={RelativeSource Mode=FindAncestor,
                    AncestorType=this:ModelSystemDisplay}, Path=ParameterWidth}" HorizontalAlignment="Stretch" materialDesign:TransitionAssist.DisableTransitions="True" >
                <StackPanel materialDesign:TransitionAssist.DisableTransitions="True"   Orientation="Vertical" HorizontalAlignment="Stretch" 
                                    x:Name="ParameterBorder">
                    <StackPanel.ToolTip>
                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding Name, Mode=OneTime}" FontWeight="Bold" Margin="0 0 3 0" />
                                <TextBlock Text="-" />
                                <TextBlock Text="{Binding OwnerModuleName, Mode=OneTime}" FontWeight="Light" Margin="3 0 0 0" />
                            </StackPanel>
                            <TextBlock Text="{Binding Description, Mode=OneTime}" />
                        </StackPanel>
                    </StackPanel.ToolTip>

                    <Grid materialDesign:TransitionAssist.DisableTransitions="True" >
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="16"></ColumnDefinition>
                            <ColumnDefinition Width="AUTO"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="AUTO"/>
                            <ColumnDefinition Width="AUTO"/>
                        </Grid.ColumnDefinitions>
                        <CheckBox materialDesign:TransitionAssist.DisableTransitions="True"  Grid.Column="1" Width="16" Margin="4,4,0,0" Height="16" VerticalAlignment="Center" IsChecked="{Binding QuickParameter}" ToolTip="Quick Parameter" Checked="ToggleButton_OnChecked"  Unchecked="ToggleButton_OnUnchecked"
                                                  IsTabStop="False"/>
                        <ComboBox  Tag="{Binding .}"  materialDesign:TransitionAssist.DisableTransitions="True"  Name="ComboBox"  Style="{StaticResource XtmfMaterialDesignFloatingHintComboBox}" PreviewKeyDown="ComboBox_PreviewKeyDown"  Grid.Column="2" materialDesign:HintAssist.Hint="{Binding Name, Mode=OneTime}"
                                          MaxWidth="{Binding RelativeSource={RelativeSource Mode=FindAncestor,
                        AncestorType=this:ModelSystemDisplay}, Path=ParameterWidth}" IsEditable="False"
                                          IsReadOnly="True" Margin="5,5,5,5" HorizontalAlignment="Stretch" FontSize="14" GotKeyboardFocus="ParameterValueTextBox_OnGotKeyboardFocus"
                                          BorderThickness="0" SelectedValue="{Binding Value}" ItemsSource="{Binding PossibleEnumerationValues, Mode=OneTime}" IsTabStop="True" SelectionChanged="ComboBox_SelectionChanged"
                                   ContextMenu="{Binding RelativeSource={RelativeSource AncestorType=ListView}, Path=ContextMenu}"/>
                        <StackPanel materialDesign:TransitionAssist.DisableTransitions="True"  Grid.Column="0" Orientation="Vertical" VerticalAlignment="Center">

                            <materialDesign:PackIcon Kind="LinkVariant" ToolTip="{Binding LinkedParameterName}" Visibility="{Binding LinkedParameterVisibility}"/>
                            <materialDesign:PackIcon Kind="Settings"  ToolTip="System Parameter" Visibility="{Binding SystemParameterVisibility, Mode=OneTime}"/>
                            <materialDesign:PackIcon Kind="DoNotDisturbAlt" ToolTip="Associated module is disabled" Visibility="{Binding ModuledDisabledIconVisiblity}"/>
                        </StackPanel>
                    </Grid>

                </StackPanel>
                <Border Background="{DynamicResource MaterialDesignDivider}" Height="1" HorizontalAlignment="Stretch" SnapsToDevicePixels="True" />
            </StackPanel>
        </DataTemplate>
        <models:ParameterTypeSelector x:Key="ParameterSelector" Standard="{StaticResource StandardParameterTemplate}" Enumeration="{StaticResource EnumerationParameterTemplate}"/>
    </UserControl.Resources>
    <materialDesign:DialogHost Identifier="RootDialog" CloseOnClickAway="True" Name="RootDialogHost">
        <Grid x:Name="LayoutRoot" Background="{DynamicResource MaterialDesignPaper}">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="55"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="24"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid Grid.Row="0" Grid.ColumnSpan="4 " Grid.RowSpan="2" >
                    <Grid VerticalAlignment="Top" Background="{DynamicResource MaterialDesignPaper}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="54"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Border Grid.Column="1"  Background="{DynamicResource MaterialDesignToolBarBackground}"></Border>
                        <ToolBarTray IsLocked="True" Grid.Row="0" Grid.Column="0" DockPanel.Dock="Left" Height="54" Margin="0 0 0 0"  Background="{DynamicResource MaterialDesignPaper}" >
                            <ToolBar  VerticalContentAlignment="Stretch" Style="{DynamicResource MaterialDesignToolBar}" ClipToBounds="True">
                                <Button ToolTip="Save Model System" Click="ButtonBase_OnClick" IsEnabled="{Binding RelativeSource={RelativeSource FindAncestor, 
                                             AncestorType={x:Type this:ModelSystemDisplay}}, Path=CanSaveModelSystem}" Name="SaveModelSystemButton"
                                        Width="36" Height="36" Margin="10 2 5 0" BorderBrush="Transparent"
                                        Background="Transparent" Foreground="{DynamicResource MaterialDesignBody}"
                                        Style="{DynamicResource MaterialDesignFloatingActionMiniButton}" VerticalAlignment="Center"
                                       >
                                    <materialDesign:PackIcon Kind="ContentSave" />
                                </Button>
                                <Button ToolTip="Linked Parameters" Click="LinkedParameter_Click" Name="LinkedParameterDisplayButton">
                                    <materialDesign:PackIcon Kind="LinkVariant" />
                                </Button>
                                <Button ToolTip="Run Model System" Click="RunModelSystem_Click" IsEnabled="{Binding RelativeSource={RelativeSource FindAncestor, 
                                             AncestorType={x:Type this:ModelSystemDisplay}}, Path=CanRunModelSystem}">
                                    <materialDesign:PackIcon Kind="Run" />
                                </Button>
                                <Button ToolTip="Open Project Folder" Click="OpenProjectFolderToolbarButton_Click" Name="OpenProjectFolderToolbarButton">
                                    <materialDesign:PackIcon Kind="FolderOpen" />
                                </Button>
                                <Button ToolTip="Reload Model System" Click="ReloadModelSystemToolbarButton_Click" Name="ReloadModelSystemToolbarButton">
                                    <materialDesign:PackIcon Kind="Reload" />
                                </Button>
                                <Grid Width="250" HorizontalAlignment="Left"   Margin="12 2 12 0" VerticalAlignment="Center">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />

                                    </Grid.ColumnDefinitions>
                                    <Button Grid.Column="0" Style="{DynamicResource MaterialDesignToolButton}">
                                        <materialDesign:PackIcon Kind="Magnify" Opacity=".56" />
                                    </Button>
                                    <my:FilterBox Opacity="0.5" Grid.Column="1" x:Name="FilterBox" UseItemSourceFilter="False" FilterWatermark="Search Modules... (Ctrl+E)" Margin="8,2,8,5" />
                                </Grid>
                            </ToolBar>
                        </ToolBarTray>
                        <ToolBarTray   Grid.Column="2" IsLocked="True" Grid.Row="0" DockPanel.Dock="Right" Height="54" Margin="0 0 0 0" VerticalAlignment="Center" >
                            <ToolBar  VerticalContentAlignment="Stretch" Style="{DynamicResource MaterialDesignToolBar}" ClipToBounds="True" VerticalAlignment="Bottom">
                                <Button Name="QuickParameterToolbarToggle" Click="QuickParameterToolbarToggle_OnClick"  >
                                    <materialDesign:PackIcon Kind="Flash"  Foreground="{Binding QuickParameterToolBarForeground}" />
                                </Button>
                                <Button ToolTip="Toggle Module Parameters Panel" Name="ModuleParametersToolbarToggle" Click="ModuleParametersToolbarToggle_OnClick"  >
                                    <materialDesign:PackIcon Kind="Tune" Foreground="{Binding ModuleParameterToolBarForeground}" />
                                </Button>
                            </ToolBar>
                        </ToolBarTray>
                    </Grid>
                </Grid>
                <Grid Grid.Row="1" Background="{DynamicResource MaterialDesignPaper}" Name="ContentDisplayGrid">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition MinWidth="100" Width="*"/>
                        <ColumnDefinition Width="1"/>
                        <ColumnDefinition MinWidth="0" Width="400" Name="QuickParameterDisplayColumnDefinition" />
                        <ColumnDefinition Width="1"/>
                        <ColumnDefinition MinWidth="0" Width="400" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <ContentControl HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Content="{Binding ActiveModelSystemView}"
                                HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch" Grid.Row="0" Grid.Column="0" 
                                Name="ModelSystemDisplayContent" />
                    <GridSplitter  Grid.Row="0" Grid.Column="1" Width="1" HorizontalAlignment="Center" VerticalAlignment="Stretch" IsTabStop="False"  ShowsPreview="True"/>
                    <GridSplitter  Grid.Row="0" Grid.Column="3" Width="1" HorizontalAlignment="Center" VerticalAlignment="Stretch" IsTabStop="False"  ShowsPreview="True"/>
                    <Grid Name="ModuleParameterDisplay" Grid.Row="0"  Grid.Column="4" IsEnabled="True"  PreviewKeyDown="ModuleParameterDisplay_OnPreviewKeyDown">
                        <materialDesign:DialogHost
                        materialDesign:ShadowAssist.ShadowDepth="Depth5"
                        x:Name="ModuleParameterDialogHost" CloseOnClickAway="True" PreviewKeyDown="ModuleParameterDialogHost_OnPreviewKeyDown">
                            <materialDesign:DialogHost.DialogContent  >
                                <Grid Width="250" VerticalAlignment="Top" />
                            </materialDesign:DialogHost.DialogContent>
                            <Grid Margin="0 0 0 0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="65"></RowDefinition>
                                    <RowDefinition Height="*"></RowDefinition>

                                </Grid.RowDefinitions>

                                <Grid  Grid.Row="0">
                                    <Grid VerticalAlignment="Bottom" HorizontalAlignment="Stretch"   Margin="0 0 5 2"  Name="ModuleParameterDisplaySearch" Opacity="0"  >
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="30" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Button  Focusable="False" Grid.Column="0" Style="{DynamicResource MaterialDesignToolButton}" Name="ModuleParameterDisplaySearchBackButton" Click="ModuleParameterDisplaySearchBackButton_OnClick">
                                            <materialDesign:PackIcon Kind="ArrowLeft" Width="25" Height="25" />
                                        </Button>
                                        <Grid Grid.Row="0" Grid.Column="1" HorizontalAlignment="Center" Width="270">
                                            <materialDesign:ColorZone   Mode="Standard" Padding="0 0 0 0" CornerRadius="2"
                                                                      Margin="5 5 5 5" UseLayoutRounding="True"
                                                                      materialDesign:ShadowAssist.ShadowDepth="Depth3">
                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                    <materialDesign:PackIcon Kind="FilterVariant" VerticalAlignment="Center" Margin="5 2 0 5"  Width="18" Height="18" Opacity="0.6"  />
                                                    <my:FilterBox VerticalAlignment="Center" Opacity="1.0" Grid.Column="1" x:Name="ParameterFilterBox" FilterWatermark="Filter Parameters... (Ctrl+Q)" Margin="4 0 0 5"/>
                                                </StackPanel>
                                            </materialDesign:ColorZone>
                                        </Grid>
                                    </Grid>

                                    <Grid Height="45" HorizontalAlignment="Stretch" Name="ModuleParameterDisplayHeader"  Margin="20 20 20 0" VerticalAlignment="Top">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"></ColumnDefinition>
                                            <ColumnDefinition Width="25"></ColumnDefinition>
                                            <ColumnDefinition Width="25"></ColumnDefinition>

                                        </Grid.ColumnDefinitions>
                                        <TextBlock Margin="0 -1 0 0" Grid.Column="0" Style="{DynamicResource MaterialDesignBody1TextBlock}" Foreground="{DynamicResource MaterialDesignBody}">Module Parameters</TextBlock>
                                        <materialDesign:PackIcon  Foreground="{DynamicResource MaterialDesignBody}" Cursor="Hand" Opacity="0.6" Grid.Column="1" Kind="FilterVariant" VerticalAlignment="Top" Width="25" Height="25" HorizontalContentAlignment="Stretch" Name="ModuleParameterSearchButton" MouseUp="ModuleParameterSearchButton_OnMouseUp" />
                                        <materialDesign:PackIcon Foreground="{DynamicResource MaterialDesignBody}" Cursor="Hand" Opacity="0.6" Grid.Column="2" Kind="Close" VerticalAlignment="Top" Width="25" Height="25" HorizontalContentAlignment="Stretch" Name="ModuleParameterDisplayClose" MouseUp="ModuleParameterDisplayClose_OnMouseUp" />
                                    </Grid>
                                </Grid>

                                <Grid Grid.Row="1" Name="PG" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="{DynamicResource MaterialDesignPaper}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="AUTO"/>
                                        <RowDefinition Height="AUTO"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <Border Padding="0" HorizontalAlignment="Stretch"  Name="ListBorder" Grid.Row="1" BorderBrush="Transparent" Background="{DynamicResource MaterialDesignPaper}" BorderThickness="0" >
                                        <Grid HorizontalAlignment="Stretch" Name="ListGrid">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <ToolBarTray Visibility="Collapsed"  IsLocked="True" Grid.Row="0" Height="52" Margin="0 0 0 0" VerticalAlignment="Center" >
                                                <ToolBar  OverflowMode="Never"  VerticalContentAlignment="Stretch" Style="{DynamicResource MaterialDesignToolBar}" ClipToBounds="True" VerticalAlignment="Center" HorizontalContentAlignment="Stretch" >

                                                    <Grid Height="70"  Width="250" VerticalAlignment="Center" HorizontalAlignment="Right"   Margin="12 4 12 12">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="*" />
                                                        </Grid.ColumnDefinitions>
                                                        <Button Focusable="False" Grid.Column="0" Style="{DynamicResource MaterialDesignToolButton}">
                                                            <materialDesign:PackIcon Kind="Magnify" Opacity=".56" />
                                                        </Button>
                                                        <my:FilterBox Height="60" Opacity="0.5"   Grid.Column="1" FilterWatermark="Filter Parameters... (Ctrl+P)" Margin="0.2cm,4,0.2cm,2"/>
                                                    </Grid>
                                                </ToolBar>
                                            </ToolBarTray>
                                            <Expander materialDesign:TransitionAssist.DisableTransitions="True" Foreground="{DynamicResource MaterialDesignBody}" Margin="0,0,16,0" HorizontalAlignment="Stretch" IsExpanded="False" Padding="0" Header="Module Description"
                                          Width="{Binding RelativeSource={RelativeSource Mode=FindAncestor,
                                            AncestorType=this:ModelSystemDisplay}, Path=ParameterWidth}"
                                          MaxWidth="{Binding RelativeSource={RelativeSource Mode=FindAncestor,
                                            AncestorType=this:ModelSystemDisplay}, Path=ParameterWidth}"
                                    Name="DescriptionExpander" Grid.Row="2" VerticalAlignment="Bottom" Background="Transparent">
                                                <Border Margin="0,4,0,0" Width="{Binding RelativeSource={RelativeSource Mode=FindAncestor,
                                            AncestorType=this:ModelSystemDisplay}, Path=ParameterWidth}"
                                            MaxWidth="{Binding RelativeSource={RelativeSource Mode=FindAncestor,
                                            AncestorType=this:ModelSystemDisplay}, Path=ParameterWidth}">
                                                    <TextBlock Margin="20 0 0 0"  Padding="5"  TextWrapping="Wrap"
                                                 HorizontalAlignment="Stretch"  x:Name="SelectedDescription" Text="No description available." Style="{DynamicResource MaterialDesignBody1TextBlock}"/>
                                                </Border>
                                            </Expander>
                                        </Grid>
                                    </Border>
                                    <ListView AllowDrop="False" materialDesign:TransitionAssist.DisableTransitions="True"   materialDesign:RippleAssist.IsDisabled="True" ScrollViewer.VerticalScrollBarVisibility="Auto" Grid.Row="2" x:Name="ParameterDisplay" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                  HorizontalContentAlignment="Stretch" Padding="0" BorderThickness="0" ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                                  Margin="0"  KeyboardNavigation.TabNavigation="Cycle"  SelectionMode="Single" ContextMenuOpening="ParameterDisplay_OnContextMenuOpening"
                                  ItemTemplateSelector="{StaticResource ParameterSelector}"  SelectionChanged="ParameterDisplay_SelectionChanged"
                                              VirtualizingPanel.IsVirtualizing="True" VirtualizingPanel.VirtualizationMode="Recycling">

                                        <ListView.ItemContainerStyle>
                                            <Style TargetType="ListViewItem" BasedOn="{StaticResource MaterialDesignListBoxItemNoTransition}">
                                                <EventSetter Event="RequestBringIntoView" Handler="EventSetter_OnHandler"/>
                                            </Style>
                                        </ListView.ItemContainerStyle>
                                        <ListView.ContextMenu>
                                            <ContextMenu>
                                                <MenuItem Header="Parameter">
                                                    <MenuItem Header="Copy (Ctrl+N)" Click="CopyParameterName_Click">
                                                        <MenuItem.Icon>
                                                            <ContentControl Template="{DynamicResource CopyIcon}"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                    <Separator/>
                                                    <MenuItem Header="Rename        (F2)" Click="RenameParameter_Click"/>
                                                    <MenuItem Header="Reset Name     " Click="ResetParameterName_Click"/>
                                                    <Separator/>
                                                    <MenuItem Header="Hide Parameter(Ctrl+H)" Click="HideParameter_Click"/>
                                                    <MenuItem Header="Show Parameter(Ctrl+Shift+H)" Click="ShowParameter_Click"/>
                                                </MenuItem>
                                                <MenuItem Header="Open">
                                                    <MenuItem Name="POpenFileMenuItem"  Header="Open File  (Ctrl+O)" Click="OpenFile_Click">
                                                        <MenuItem.Icon>
                                                            <ContentControl Template="{DynamicResource OpenIcon}"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                    <MenuItem Header="Open File With" Click="OpenWith_Click"/>
                                                    <MenuItem Header="Open File Location" Click="OpenFolder_Click"/>
                                                </MenuItem>
                                                <Separator/>
                                                <MenuItem Name="PSelectFileMenuItem" Header="Select File (Ctrl+F)" Click="SelectFile_Click">
                                                    <MenuItem.Icon>
                                                        <ContentControl Template="{DynamicResource EditIcon}"/>
                                                    </MenuItem.Icon>
                                                </MenuItem>
                                                <MenuItem Name="PSelectDirectoryMenuItem" Header="Select Directory (Ctrl+D)" Click="SelectDirectory_Click">
                                                </MenuItem>
                                                <Separator/>
                                                <MenuItem x:Name="ParameterLinkedParameterMenuItem" Header="Assign Linked Parameter (Ctrl+L)" Click="AssignLinkedParameters_Click">
                                                    <MenuItem.Icon>
                                                        <ContentControl Template="{DynamicResource LinkIcon}"/>
                                                    </MenuItem.Icon>
                                                </MenuItem>
                                                <MenuItem x:Name="ParameterRecentLinkedParameters" Header="Recent Linked Parameters" IsEnabled="False">
                                                    <MenuItem.ItemTemplate>
                                                        <DataTemplate DataType="{x:Type models:LinkedParameterDisplayModel}">
                                                            <TextBlock Text="{Binding Name}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
                                                        </DataTemplate>
                                                    </MenuItem.ItemTemplate>
                                                    <MenuItem.ItemContainerStyle>
                                                        <Style TargetType="{x:Type MenuItem}">
                                                            <EventSetter Event="Click" Handler="RecentLinkedParameter_Click"/>
                                                        </Style>
                                                    </MenuItem.ItemContainerStyle>
                                                </MenuItem>
                                                <MenuItem Header="Remove From Linked Parameter" Click="RemoveLinkedParameters_Click">
                                                    <MenuItem.Icon>
                                                        <ContentControl Template="{DynamicResource CancelIcon}"/>
                                                    </MenuItem.Icon>
                                                </MenuItem>
                                                <MenuItem Header="Reset to Default" Click="ResetParameter_Click">
                                                    <MenuItem.Icon>
                                                        <ContentControl Template="{DynamicResource RefreshIcon}"/>
                                                    </MenuItem.Icon>
                                                </MenuItem>
                                            </ContextMenu>
                                        </ListView.ContextMenu>
                                    </ListView>
                                </Grid>
                            </Grid>
                        </materialDesign:DialogHost>
                    </Grid>
                    <Grid Name="QuickParameterDisplay2"  Grid.Column="2" IsEnabled="True" PreviewKeyDown="QuickParameterDisplay2_OnPreviewKeyDown" >
                        <materialDesign:DialogHost x:Name="QuickParameterDialogHost"  CloseOnClickAway="True" DialogOpened="QuickParameterDialogHost_OnDialogOpened"
                                                   PreviewKeyDown="QuickParameterDialogHost_OnPreviewKeyDown">
                            <materialDesign:DialogHost.DialogContent >
                                <Grid Width="200" />
                            </materialDesign:DialogHost.DialogContent>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="65"></RowDefinition>
                                    <RowDefinition Height="*"></RowDefinition>
                                </Grid.RowDefinitions>

                                <Grid  Grid.Row="0">
                                    <Grid VerticalAlignment="Bottom" HorizontalAlignment="Stretch" Margin="0 0 5 2"  Name="QuickParameterDisplaySearch" Opacity="0"  >
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="30" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Button  Focusable="False" Grid.Column="0" Style="{DynamicResource MaterialDesignToolButton}" Name="QuickParameterDisplaySearchBackButton" Click="QuickParameterDisplaySearchBackButton_OnClick">
                                            <materialDesign:PackIcon Kind="ArrowLeft" Width="25" Height="25" />
                                        </Button>
                                        <Grid Grid.Row="0" Grid.Column="1" HorizontalAlignment="Center" Width="270">
                                            <materialDesign:ColorZone   Mode="Standard" Padding="0 0 0 0" CornerRadius="2"
                                                                      Margin="5 5 5 5" UseLayoutRounding="True"
                                                                      materialDesign:ShadowAssist.ShadowDepth="Depth3">
                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                    <materialDesign:PackIcon Kind="FilterVariant" VerticalAlignment="Center" Margin="5 2 0 5"  Width="18" Height="18" Opacity="0.6"  />
                                                    <my:FilterBox VerticalAlignment="Center" Opacity="1.0" Grid.Column="1" x:Name="QuickParameterFilterBox" FilterWatermark="Filter Parameters... (Ctrl+Q)" Margin="4 0 0 5" />
                                                </StackPanel>
                                            </materialDesign:ColorZone>
                                        </Grid>
                                    </Grid>

                                    <Grid Height="45" HorizontalAlignment="Stretch" Name="QuickParameterDisplayHeader"  Margin="20 20 20 0" VerticalAlignment="Top">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"></ColumnDefinition>
                                            <ColumnDefinition Width="25"></ColumnDefinition>
                                            <ColumnDefinition Width="25"></ColumnDefinition>

                                        </Grid.ColumnDefinitions>
                                        <TextBlock Margin="0 -1 0 0" Grid.Column="0" Style="{DynamicResource MaterialDesignBody1TextBlock}" Foreground="{DynamicResource MaterialDesignBody}">Quick Parameters</TextBlock>
                                        <materialDesign:PackIcon  Foreground="{DynamicResource MaterialDesignBody}" Cursor="Hand" Opacity="0.6" Grid.Column="1" Kind="FilterVariant" VerticalAlignment="Top" Width="25" Height="25" HorizontalContentAlignment="Stretch" Name="QuickParameterSearchButton" MouseUp="QuickParameterSearchButton_OnMouseUp" />
                                        <materialDesign:PackIcon Foreground="{DynamicResource MaterialDesignBody}" Cursor="Hand" Opacity="0.6" Grid.Column="2" Kind="Close" VerticalAlignment="Top" Width="25" Height="25" HorizontalContentAlignment="Stretch" Name="QuickParameterDisplayClose" MouseUp="QuickParameterDisplayClose_MouseUp" />
                                    </Grid>
                                </Grid>
                                <Grid  HorizontalAlignment="Stretch" Background="{DynamicResource MaterialDesignPaper}" Grid.Row="1">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="AUTO"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <Grid Grid.Row="0" HorizontalAlignment="Center" >
                                        <ToolBarTray  Visibility="Collapsed"   IsLocked="True"  Height="52" Margin="0 0 0 0" VerticalAlignment="Top" Background="Transparent" HorizontalAlignment="Stretch" >
                                            <ToolBar  OverflowMode="Never"  VerticalContentAlignment="Stretch" Style="{DynamicResource MaterialDesignToolBar}" 
                                                      Background="Transparent" ClipToBounds="True" VerticalAlignment="Center" 
                                                      HorizontalContentAlignment="Center" />
                                        </ToolBarTray>
                                    </Grid>
                                    <ListView   
                                        materialDesign:RippleAssist.IsDisabled="True" Grid.Row="1" x:Name="QuickParameterListView"
                                  HorizontalAlignment="Stretch" SelectionChanged="QuickParameterDisplay_SelectionChanged"
                                  VerticalAlignment="Stretch" Padding="0" BorderThickness="0" SelectionMode="Single"
                                  HorizontalContentAlignment="Stretch" ScrollViewer.HorizontalScrollBarVisibility="Hidden" ContextMenuOpening="QuickParameterListView_OnContextMenuOpening"
                                  Margin="0" Background="{DynamicResource MaterialDesignPaper}" KeyboardNavigation.TabNavigation="Cycle"
                                        ItemTemplateSelector="{StaticResource ParameterSelector}"
                                        VirtualizingPanel.IsVirtualizing="True" VirtualizingPanel.VirtualizationMode="Recycling">
                                        <ListView.ItemContainerStyle>
                                            <Style TargetType="ListViewItem" BasedOn="{StaticResource MaterialDesignListBoxItemNoTransition}">
                                                <EventSetter Event="RequestBringIntoView" Handler="EventSetter_OnHandler"></EventSetter>
                                            </Style>
                                        </ListView.ItemContainerStyle>
                                        <ListView.ContextMenu>
                                            <ContextMenu Name="QuickParameterContextMenu" ContextMenuOpening="QuickParameterContextMenu_ContextMenuOpening">
                                                <MenuItem Header="Copy Parameter Name (Ctrl+N)" Click="CopyParameterName_Click">
                                                    <MenuItem.Icon>
                                                        <ContentControl Template="{DynamicResource CopyIcon}"/>
                                                    </MenuItem.Icon>
                                                </MenuItem>
                                                <MenuItem Header="Go To Module" Click="GoToModule_Click"/>
                                                <Separator/>
                                                <MenuItem Header="Open">
                                                    <MenuItem Header="Open File  (Ctrl+O)" Click="OpenFile_Click">
                                                        <MenuItem.Icon>
                                                            <ContentControl Template="{DynamicResource OpenIcon}"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                    <MenuItem Header="Open File With" Click="OpenWith_Click"/>
                                                    <MenuItem Header="Open File Location" Click="OpenFolder_Click"/>
                                                </MenuItem>
                                                <Separator/>
                                                <MenuItem Name="SelectFileMenuItem" Header="Select File (Ctrl+F)" Click="SelectFile_Click">
                                                    <MenuItem.Icon>
                                                        <ContentControl Template="{DynamicResource EditIcon}"/>
                                                    </MenuItem.Icon>
                                                </MenuItem>
                                                <MenuItem Name="SelectDirectoryMenuItem"  Header="Select Directory (Ctrl+D)" Click="SelectDirectory_Click"/>
                                                <Separator/>
                                                <MenuItem Header="Assign Linked Parameter (Ctrl+L)" Click="AssignLinkedParameters_Click">
                                                    <MenuItem.Icon>
                                                        <ContentControl Template="{DynamicResource LinkIcon}"/>
                                                    </MenuItem.Icon>
                                                </MenuItem>
                                                <MenuItem x:Name="QuickParameterRecentLinkedParameters" Header="Recent Linked Parameters" IsEnabled="False">
                                                    <MenuItem.ItemTemplate>
                                                        <DataTemplate DataType="{x:Type models:LinkedParameterDisplayModel}">
                                                            <TextBlock Text="{Binding Name}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
                                                        </DataTemplate>
                                                    </MenuItem.ItemTemplate>
                                                    <MenuItem.ItemContainerStyle>
                                                        <Style TargetType="{x:Type MenuItem}">
                                                            <EventSetter Event="Click" Handler="RecentLinkedParameter_Click"/>
                                                        </Style>
                                                    </MenuItem.ItemContainerStyle>
                                                </MenuItem>
                                                <MenuItem Header="Remove From Linked Parameter" Click="RemoveLinkedParameters_Click">
                                                    <MenuItem.Icon>
                                                        <ContentControl Template="{DynamicResource CancelIcon}"/>
                                                    </MenuItem.Icon>
                                                </MenuItem>
                                                <MenuItem Header="Reset to Default" Click="ResetParameter_Click">
                                                    <MenuItem.Icon>
                                                        <ContentControl Template="{DynamicResource RefreshIcon}"/>
                                                    </MenuItem.Icon>
                                                </MenuItem>
                                            </ContextMenu>
                                        </ListView.ContextMenu>
                                    </ListView>
                                </Grid>

                            </Grid>
                        </materialDesign:DialogHost>
                    </Grid>
                    <Popup StaysOpen="False" Name="NoUnassignedModulesPopup" Width="200" Height="Auto" Placement="Top" PlacementTarget="{Binding ElementName=UnassignedModulesStatusBar}" PopupAnimation="Slide">
                        <Border BorderBrush="{DynamicResource MaterialDesignTextBoxBorder}" BorderThickness="1">
                            <Grid Background="{DynamicResource MaterialDesignBackground}" MaxHeight="100">
                                <Label Padding="10" Foreground="{DynamicResource MaterialDesignColumnHeader}">No required modules missing.</Label>
                            </Grid>
                        </Border>
                    </Popup>
                    <Popup StaysOpen="False" Name="UnassignedModulesPopup" Width="200" Height="Auto" Placement="Top" PlacementTarget="{Binding ElementName=UnassignedModulesStatusBar}" PopupAnimation="Slide">
                        <Border BorderBrush="{DynamicResource MaterialDesignTextBoxBorder}" BorderThickness="1">
                            <Grid Background="{DynamicResource MaterialDesignBackground}" MaxHeight="250">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="30"></RowDefinition>
                                    <RowDefinition Height="*"></RowDefinition>
                                </Grid.RowDefinitions>
                                <Label Foreground="{DynamicResource MaterialDesignColumnHeader}" Grid.Row="0">Missing Required Modules</Label>
                                <ListView Grid.Row="1" Name="UnassignedModulesList" VerticalContentAlignment="Stretch" HorizontalContentAlignment="Stretch" ScrollViewer.CanContentScroll="True">
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <Label Tag="{Binding .}" MouseDown="UnassignedModuleLabel_MouseDown" Content="{Binding Name}"></Label>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </Grid>
                        </Border>
                    </Popup>
                    <Popup StaysOpen="False" Name="DisabledModulesPopup" Width="200" Height="Auto" Placement="Top" PlacementTarget="{Binding ElementName=DisabledModulesStatusBar}" PopupAnimation="Slide">
                        <Border BorderBrush="{DynamicResource MaterialDesignTextBoxBorder}" BorderThickness="1">
                            <Grid Background="{DynamicResource MaterialDesignBackground}" MaxHeight="250">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="30"></RowDefinition>
                                    <RowDefinition Height="*"></RowDefinition>
                                </Grid.RowDefinitions>
                                <Label Foreground="{DynamicResource MaterialDesignColumnHeader}" Grid.Row="0">Disabled Modules</Label>
                                <ListView Grid.Row="1" Name="DisabledModulesPopupList" VerticalContentAlignment="Stretch" HorizontalContentAlignment="Stretch" ScrollViewer.CanContentScroll="True">
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <Label Tag="{Binding .}" MouseDown="UnassignedModuleLabel_MouseDown" Content="{Binding Name}"></Label>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>

                                </ListView>


                            </Grid>
                        </Border>
                    </Popup>
                </Grid>
                <StatusBar  Name="StatusBar" Grid.Row="2" Grid.Column="0" Background="{DynamicResource SecondaryHueDarkBrush}" Height="24">
                    <StatusBar.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Grid >
                                <Grid.ColumnDefinitions>

                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="190"></ColumnDefinition>
                                    <ColumnDefinition Width="130"></ColumnDefinition>
                                    <ColumnDefinition Width="130"></ColumnDefinition>
                                </Grid.ColumnDefinitions>


                            </Grid>

                        </ItemsPanelTemplate>
                    </StatusBar.ItemsPanel>
                    <StatusBarItem Grid.Column="0">
                        <TextBlock  Text="No module selected." Name="StatusBarModuleNameTextBlock"></TextBlock>
                    </StatusBarItem>
                    <StatusBarItem Grid.Column="1">

                    </StatusBarItem>
                    <StatusBarItem Grid.Column="2"></StatusBarItem>


                    <StatusBarItem HorizontalAlignment="Left" Grid.Column="3" Name="UnassignedModulesStatusBar" MouseUp="UnassignedModulesStatusBar_MouseDown">

                        <StatusBarItem.Style>

                            <Style TargetType="{x:Type StatusBarItem}">
                                <Style.Setters>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="StatusBarItem">
                                                <Border>

                                                    <Grid>
                                                        <Rectangle Name="bg" Fill="{DynamicResource SecondaryHueDarkBrush}"></Rectangle>
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"></ContentPresenter>
                                                    </Grid>
                                                </Border>
                                                <ControlTemplate.Triggers>

                                                    <Trigger Property="IsMouseOver" Value="True">

                                                        <Setter TargetName="bg" Property="Opacity" Value="0.2"></Setter>

                                                    </Trigger>
                                                    <Trigger Property="IsMouseOver" Value="False">

                                                        <Setter TargetName="bg" Property="Opacity" Value="0.0"></Setter>

                                                    </Trigger>

                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style.Setters>

                            </Style>
                        </StatusBarItem.Style>

                        <StackPanel Margin="5 0 5 0" HorizontalAlignment="Left" Orientation="Horizontal" VerticalAlignment="Top">
                            <materialDesign:PackIcon Kind="InfoOutline" />
                            <TextBlock FontSize="11" VerticalAlignment="Stretch" Margin="4 0 0 0"  FontWeight="Normal" >Model System Requirements</TextBlock>
                        </StackPanel>



                    </StatusBarItem>

                    <StatusBarItem Grid.Column="4">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Top">
                            <materialDesign:PackIcon Kind="Settings" Height="16" />
                            <TextBlock Name="StatusBarModuleCountTextBlock" Text="{Binding Path=StatusBarModuleCountText, Mode=OneWay}"  FontSize="11" VerticalAlignment="Stretch" Margin="4 0 0 0"  FontWeight="Normal"></TextBlock>

                        </StackPanel>

                    </StatusBarItem>

                    <StatusBarItem Grid.Column="5" Name="DisabledModulesStatusBar" MouseUp="DisabledModulesStatusBar_MouseUp">

                        <StatusBarItem.Style>

                            <Style TargetType="{x:Type StatusBarItem}">
                                <Style.Setters>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="StatusBarItem">
                                                <Border>


                                                    <Grid HorizontalAlignment="Left">
                                                        <Rectangle Name="bg" Fill="{DynamicResource SecondaryHueLightBrush}"></Rectangle>
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"></ContentPresenter>
                                                    </Grid>
                                                </Border>
                                                <ControlTemplate.Triggers>

                                                    <Trigger Property="IsMouseOver" Value="True">

                                                        <Setter TargetName="bg" Property="Opacity" Value="0.2"></Setter>

                                                    </Trigger>
                                                    <Trigger Property="IsMouseOver" Value="False">

                                                        <Setter TargetName="bg" Property="Opacity" Value="0.0"></Setter>

                                                    </Trigger>

                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style.Setters>

                            </Style>
                        </StatusBarItem.Style>
                        <StackPanel Margin="5 0 5 0" Orientation="Horizontal" VerticalAlignment="Top" >
                            <materialDesign:PackIcon Kind="DoNotDisturbAlt" Height="16" ToolTip="Disabled Modules" />
                            <TextBlock Name="StatusBarDisabledModulesText"  Text="{Binding Path=DisabledModulesCountTextBlock, Mode=OneWay,UpdateSourceTrigger=PropertyChanged}" FontSize="10" VerticalAlignment="Stretch" Margin="2 0 0 0"  FontWeight="Bold"/>
                        </StackPanel>

                    </StatusBarItem>
                </StatusBar>
            </Grid>
            <materialDesign:Snackbar x:Name="StatusSnackBar" MessageQueue="{materialDesign:MessageQueue}" />
        </Grid>
    </materialDesign:DialogHost>
</UserControl>



